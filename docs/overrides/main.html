{% extends "base.html" %}

{% block extrahead %}
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({startOnLoad:true});
  </script>
{% endblock %}

{% block content %}
  {{ super() }}
  <script>
    // Convert all mermaid code blocks to divs after page load
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Converting Mermaid blocks...');
      
      // Find all pre.mermaid code blocks
      const mermaidCodeBlocks = document.querySelectorAll('pre.mermaid code');
      console.log('Found ' + mermaidCodeBlocks.length + ' Mermaid code blocks');
      
      mermaidCodeBlocks.forEach(function(codeBlock, index) {
        // Create new div element
        const mermaidDiv = document.createElement('div');
        mermaidDiv.className = 'mermaid';
        mermaidDiv.textContent = codeBlock.textContent;
        
        // Replace the entire pre element with the div
        const preElement = codeBlock.parentElement;
        preElement.parentNode.replaceChild(mermaidDiv, preElement);
        
        console.log('Converted block ' + (index + 1));
      });
      
      // Force mermaid to process the new divs
      setTimeout(function() {
        mermaid.init(undefined, '.mermaid');
        console.log('Mermaid processing complete');
      }, 100);
    });
  </script>
{% endblock %}